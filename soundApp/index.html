<html>

<head>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/timepicker@1.13.10/jquery.timepicker.js"></script>
    <link rel="stylesheet" href="timePickerCSS.css">
</head>

<body>
    <audio id='myAudio' src='lets begin.m4a'></audio>
    <button id='soundButton' onclick="playAudio()" type="button">Play Sounds</button>
    <button id='stopSoundButton' onclick="stopAudio()" type="button">Stop sounds</button>

    <label for="soundFade">Sound fade:</label>
    <select id="fadeDropdown" name="soundFade">
        <option value=null>No fade</option>
        <option value="linear">Linear fade</option>
        <option value="squareRoot">Square root fade</option>
        <option value="sinusoidal">Sinusoidal fade</option>
    </select>
    <label for="fadeDurationInput">Fade Duration (milliseconds):</label>
    <input type="number" id="fadeDurationInput" name="fadeDurationInput" min="0" max="10000">
    <br>

    <article>
        <div class="timePicker">
            <p>
                <label>Stop playing at:</label>
                <input onchange='setStopPlayingTime()' id="durationExample" type="time" class="time" />
            </p>
        </div>
        <script>
            $(function () {
                $('#durationExample').timepicker({
                    'minTime': new Date(),
                    'showDuration': true,
                    'step': 10,
                    'timeFormat': 'H:i',
                    'noneOption': [
                        {
                            'label': 'Never Stop',
                            'className': 'neverStop',
                            'value': 'Never Stop'
                        }
                    ]
                });
            });

            let globalSetTimeout;
            function setStopPlayingTime() {
                console.log('global set timeout before', globalSetTimeout);
                clearTimeout(globalSetTimeout);
                console.log('global set timeout after', globalSetTimeout);
                const stopPlayingAtTime = $('#durationExample').val();
                console.log('Stop playing at: ' + stopPlayingAtTime);
                if (stopPlayingAtTime === 'Never Stop') {
                    return;
                }
                const hours = stopPlayingAtTime.split(':')[0];
                const minutes = stopPlayingAtTime.split(':')[1];
                const timeNow = new Date();
                const stopAtMillis = new Date().setHours(hours, minutes);
                const timeNowMillis = new Date().getTime();
                const stopInMilliseconds = stopAtMillis - timeNowMillis;
                globalSetTimeout = setTimeout(() => { stopAudio() }, stopInMilliseconds);
                
            }
        </script>
    </article>



    <p id='text'></p>
</body>
<script>
    // TODO: Add an option to wait between sound recordings
    // TODO: Add an option to 'Stop playing at' with a datepicker
    // TODO: Add an option to play recordings in parallel
    // TODO: Add an option to upload your own recordings
    // TODO: Add an option to record your own recordings
    // TODO: Consider rebuilding this in a framework such as angular
    // TODO: Consider building a development environment as well as a production one
    // TODO: (maybe in the future) - Make this a Freemium service, add payment system for premium features, advertise service with google ads

</script>

<script src='util.js'></script>
<script src='soundModification.js'></script>
<script src='core.js'></script>

<html>